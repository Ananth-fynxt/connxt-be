# Common Application Configuration
# This file contains shared configuration for all services

spring:
  # Import additional configuration files
  config:
    import:
      - classpath:application-routes.yml
  # Database Configuration (JDBC)
  datasource:
    url: jdbc:postgresql://${DATABASE_HOST}:${DATABASE_PORT}/${DATABASE_NAME}
    username: ${DATABASE_USERNAME}
    password: ${DATABASE_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      pool-name: ConnxtHikariPool
      maximum-pool-size: 10
      minimum-idle: 2
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      leak-detection-threshold: 60000

  # JPA Configuration
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: validate  # Use Flyway for schema management
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        jdbc:
          batch_size: 20
          time_zone: UTC
        order_inserts: true
        order_updates: true
        type:
          prefer_native_enum_types: true
        query:
          in_clause_parameter_padding: true
        # Use legacy naming strategy for sequences to avoid _seq suffix
        id:
          db_structure_naming_strategy: legacy

# Server Configuration
server:
  port: 7111

# API Configuration
api:
  prefix: /api/v1
  frontend-url: http://localhost:3000,http://localhost:5173,${FRONTEND_URL}
  backend-server-url: ${BACKEND_SERVER_URL}
  swagger:
    server-url: ${BACKEND_SERVER_URL},http://localhost:7111

# Logging Configuration
logging:
  level:
    root: INFO
    connxt: DEBUG
    org.springframework: INFO
    org.hibernate: INFO
    org.springframework.web.cors: DEBUG
    org.springframework.security.web.FilterChainProxy: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - [correlationId:%X{correlationId}] %msg%n"


# Security Configuration
security:
  jwt:
    issuer: ${JWT_ISSUER}
    audience: ${JWT_AUDIENCE}
    signing-key-id: ${JWT_SIGNING_KEY_ID}
    refresh-signing-key-id: ${JWT_REFRESH_SIGNING_KEY_ID}
    access-token-expiration: ${JWT_ACCESS_TOKEN_EXPIRATION}
    refresh-token-expiration: ${JWT_REFRESH_TOKEN_EXPIRATION}

# Swagger Configuration
swagger:
  enabled: true

# CORS Configuration
cors:
  allowed-origins: http://localhost:3000,http://localhost:5173,${FRONTEND_URL}
  allowed-methods: GET,POST,PUT,PATCH,DELETE,OPTIONS
  allowed-headers: "*"
  allow-credentials: true

# HTTP Client Configuration
http:
  client:
    connection-timeout-ms: 10000
    read-timeout-ms: 30000

# Email Configuration
email:
  enabled: true
  connection-string: ${EMAIL_CONNECTION_STRING}
  sender-address: ${EMAIL_SENDER_ADDRESS}
  enable-detailed-logging: false